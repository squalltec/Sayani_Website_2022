/*
 * jQuery.counter plugin
 *
 * Copyright (c) 2012 Sophilabs <hi@sophilabs.com>
 * MIT License
 */
 
!function(a,b){"function"==typeof define&&"object"==typeof define.amd?define(["jquery"],b):b(a.$)}(this,function(a){var b=function(b){var c=0,d=0;return a.each(b.parts,function(a,b){c+=c*b.limit+b.stop,d+=d*b.limit+b.value}),b.down?c>=d:c<=d},c=function(){for(var c=a(this),e=c.data("counter"),f=e.parts.length-1;f>=0;){var g=e.parts[f];if(g.value+=e.down?-1:1,e.down&&g.value<0)g.value=g.limit;else{if(e.down||!(g.value>g.limit))break;g.value=0}f--}d(c,f),b(e)&&(clearInterval(e.intervalId),c.trigger("counterStop"))},d=function(b,c){for(var d=b.data("counter"),g=d.parts.length-1,h=function(a,c){e(b,g,a,c)};g>=c;){for(var i=d.parts[g],j=i.value+"";j.length<i.padding;)j="0"+j;a.each(f(j,""),h),g--}},e=function(b,c,d,e){var f=a(a(b.children("span.part").get(c)).find("span.digit").get(d));f.attr("class","digit digit"+e+" digit"+f.text()+e).text(e)},f=function(a){var d,b=String.prototype.split,c=/()??/.exec("")[1]===a;return d=function(d,e,f){if("[object RegExp]"!==Object.prototype.toString.call(e))return b.call(d,e,f);var j,k,l,m,g=[],h=(e.ignoreCase?"i":"")+(e.multiline?"m":"")+(e.extended?"x":"")+(e.sticky?"y":""),i=0,e=new RegExp(e.source,h+"g");for(d+="",c||(j=new RegExp("^"+e.source+"$(?!\\s)",h)),f=f===a?-1>>>0:f>>>0;(k=e.exec(d))&&(l=k.index+k[0].length,!(l>i&&(g.push(d.slice(i,k.index)),!c&&k.length>1&&k[0].replace(j,function(){for(var b=1;b<arguments.length-2;b++)arguments[b]===a&&(k[b]=a)}),k.length>1&&k.index<d.length&&Array.prototype.push.apply(g,k.slice(1)),m=k[0].length,i=l,g.length>=f)));)e.lastIndex===k.index&&e.lastIndex++;return i===d.length?!m&&e.test("")||g.push(""):g.push(d.slice(i)),g.length>f?g.slice(0,f):g}}(),g={init:function(d){return d=d||{},this.each(function(){var e=a(this),g=e.data("counter")||{};g.interval=parseInt(d.interval||e.attr("data-interval")||"1000",10),g.down="down"==(d.direction||e.attr("data-direction")||"down"),g.parts=[];var h=f(d.initial||e.text(),/([^0-9]+)/),i=f(d.format||e.attr("data-format")||"23:59:59",/([^0-9]+)/),j=d.stop||e.attr("data-stop");return j&&(j=f(j,/([^0-9]+)/)),e.html(""),a.each(i,function(b,c){if(/^\d+$/.test(c)){var d={};d.index=b,d.padding=(c+"").length,d.limit=parseInt(c,10),d.value=parseInt(h[h.length-i.length+b]||0,10),d.value=d.value>d.limit?d.limit:d.value,d.reset=d.value,d.stop=parseInt(j?j[j.length-i.length+b]:g.down?0:d.limit,10),d.stop=d.stop>d.limit?d.limit:d.stop,d.stop=d.stop<0?0:d.stop;for(var k=a("<span>").addClass("part").addClass("part"+b),l=d.value+"";l.length<d.padding;)l="0"+l;a.each(f(l,""),function(b,c){k.append(a("<span>").addClass("digit digit"+c).text(c))}),e.append(k),g.parts.push(d)}else e.append(a("<span>").addClass("separator").addClass("separator"+b).text(c))}),b(g)?e.trigger("counterStop"):g.intervalId=setInterval(a.proxy(c,this),g.interval),e.data("counter",g),this})},play:function(){return this.each(function(){var b=a(this),d=b.data("counter");d.intervalId||(d.intervalId=setInterval(a.proxy(c,this),d.interval))})},reset:function(){return this.each(function(){var b=a(this),e=b.data("counter");a.each(e.parts,function(a,b){b.value=b.reset}),d(a(this),0),e.intervalId&&(clearInterval(e.intervalId),e.intervalId=setInterval(a.proxy(c,this),e.interval))})},stop:function(){return this.each(function(){var b=a(this),c=b.data("counter");clearInterval(c.intervalId),c.intervalId=0,b.trigger("counterStop")})}};a.fn.counter=function(b){return g[b]?g[b].apply(this,Array.prototype.slice.call(arguments,1)):"object"!=typeof b&&b?void a.error("Method "+b+" does not exist on jQuery.counter"):g.init.apply(this,arguments)}});